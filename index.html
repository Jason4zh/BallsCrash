<!DOCTYPE html>
<html>

<head>
  <title>小球碰撞 BCS</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
    }

    #simCanvas {
      border: 1px solid #ccc;
    }

    button {
      margin: 5px;
      padding: 5px 10px;
    }
  </style>
</head>

<body>
  <canvas id="simCanvas" width="900" height="900"></canvas>
  <div id="killFeed"
    style="margin-top: 10px; padding: 10px; border: 1px solid #ccc; height: 150px; width: 300px; overflow-y: auto;">
  </div>
  <div>
    <button id="startBtn">开始</button>
    <button id="stopBtn">停止</button>
    <button id="addBallBtn">添加小球</button>
  </div>

  <script src="bcs.js"></script>
  <script>
    // 获取Canvas元素
    const canvas = document.getElementById('simCanvas');
    canvas.width = (window.innerWidth - 100).toString()
    canvas.height = (window.innerHeight - 100).toString()
    // 创建模拟器实例
    const simulator = new BallCollisionSimulator(canvas, {
      colors: ['#FF6B6B', '#4ECDC4', '#45B7D1', '#FFBE0B']
    });

    // 监听击杀事件并更新播报
    simulator.onKill = (killInfo) => {
      const killFeedElement = document.getElementById('killFeed');

      // 创建播报条目
      const killEntry = document.createElement('div');
      killEntry.style.margin = '5px 0';
      killEntry.innerHTML = `
    <span style="color: ${killInfo.killerColor}; font-weight: bold;font-size: 30px;">●</span>
    击杀了
    <span style="color: ${killInfo.victimColor}; font-weight: bold;font-size: 30px;">●</span>
  ，剩余<span style="font-weight: bold">${killInfo.ballsNumber}</span>球。`;
      if (killInfo.ballsNumber == 1) {
        killEntry.innerHTML += `<span style="color: ${killInfo.killerColor}; font-weight: bold;font-size: 30px;">●</span>赢了`
      }
      // 添加到播报区域顶部
      if (killFeedElement.firstChild) {
        killFeedElement.insertBefore(killEntry, killFeedElement.firstChild);
      } else {
        killFeedElement.appendChild(killEntry);
      }
      if (killInfo.ballsNumber == 3){
        const interval = setInterval(()=>{
          var size = simulator.reduceBoxSize("box",1)
          if(Math.min(size[0],size[1])<=250){
            clearInterval(interval);
            simulator.placeKnifeRandomly()
            simulator.placeHeartRandomly()
          }
        },20)
        
      }

    };

    const t = (window.innerHeight - 100) * (window.innerWidth - 100) / 50000

    // 按钮事件
    document.getElementById('startBtn').addEventListener('click', () => simulator.start());
    document.getElementById('stopBtn').addEventListener('click', () => simulator.stop());

    document.getElementById('addBallBtn').addEventListener('click', () => {
      // 添加随机小球
      var color = 'rgb(' + Math.round(Math.random() * 255) + ',' + Math.round(Math.random() * 255) + ',' + Math.round(Math.random() * 255) + ')'
      console.log(color)
      simulator.addBall({
        radius: 60,
        mass: 6,
        vx: (Math.random() * t),
        vy: (Math.random() * t),
        color: color
      });
    });

    const knife = new Image()
    knife.src = 'knife.png';
    simulator.setKnifeImage(knife)

    const heart = new Image()
    heart.src = 'heart.png';
    simulator.setHeartImage(heart)

  </script>
</body>

</html>
